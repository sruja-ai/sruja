name: SEO Sitemap Submission

on:
  workflow_dispatch:
  schedule:
    # Run weekly on Tuesdays at 9 AM UTC (after Monday deployments)
    - cron: '0 9 * * 2'

jobs:
  submit-sitemap:
    name: Submit Sitemap to Search Engines
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    
    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - name: Submit to Google
        run: |
          echo "=== Submitting sitemap to Google ==="
          SITEMAP_URL="https://sruja.ai/sitemap.xml"
          echo "Pinging Google with: $SITEMAP_URL"
          
          # Ping Google about sitemap update - FREE, no API key required
          curl -s "https://www.google.com/ping?sitemap=${SITEMAP_URL}" && \
            echo "✓ Successfully pinged Google" || \
            echo "⚠️ Failed to ping Google"

      - name: Submit to Bing
        run: |
          echo "=== Submitting sitemap to Bing ==="
          SITEMAP_URL="https://sruja.ai/sitemap.xml"
          echo "Pinging Bing with: $SITEMAP_URL"
          
          # Ping Bing about sitemap update - FREE, no API key required
          curl -s "https://www.bing.com/ping?sitemap=${SITEMAP_URL}" && \
            echo "✓ Successfully pinged Bing" || \
            echo "⚠️ Failed to ping Bing"

      - name: Submit to Yandex
        run: |
          echo "=== Submitting sitemap to Yandex ==="
          SITEMAP_URL="https://sruja.ai/sitemap.xml"
          echo "Pinging Yandex with: $SITEMAP_URL"
          
          # Ping Yandex - FREE, no API key required
          curl -s "https://webmaster.yandex.com/ping?sitemap=${SITEMAP_URL}" && \
            echo "✓ Successfully pinged Yandex" || \
            echo "⚠️ Failed to ping Yandex"

      - name: Summary
        run: |
          echo "## Sitemap Submission Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "✅ Sitemap submitted to search engines:" >> $GITHUB_STEP_SUMMARY
          echo "- Google (via ping)" >> $GITHUB_STEP_SUMMARY
          echo "- Bing (via ping)" >> $GITHUB_STEP_SUMMARY
          echo "- Yandex (via ping)" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Current Method**: Using ping endpoints - **100% FREE, no API keys needed!**" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Optional**: For advanced features (submission status, indexing requests), see:" >> $GITHUB_STEP_SUMMARY
          echo "- Google Search Console API (FREE but requires setup)" >> $GITHUB_STEP_SUMMARY
          echo "- See \`docs/SEO_SUBMISSION_AUTOMATION.md\` for details" >> $GITHUB_STEP_SUMMARY

