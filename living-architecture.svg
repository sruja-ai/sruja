<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg
    xmlns="http://www.w3.org/2000/svg"
    xmlns:xlink="http://www.w3.org/1999/xlink"
    version="1.1"
    width="100%"
    height="100%"
    viewBox="0 0 2000 1200">
    <title>Living Architecture Document: Interactive C4 & Documentation</title>
    <desc>A single, shareable SVG file containing C4 architecture diagrams, requirements, user stories, and ADRs, managed by embedded JavaScript.</desc>

    <!--
    ================================================================================
    1. STYLES (Embedded CSS)
    ================================================================================
    -->
    <style type="text/css">
        /* General Layout and Text */
        text { font-family: 'Arial', sans-serif; fill: #2c3e50; }
        .title { font-size: 40px; font-weight: bold; fill: #2c3e50; }
        .subtitle { font-size: 20px; fill: #7f8c8d; }
        .section-header { font-size: 28px; font-weight: bold; fill: #34495e; text-decoration: underline; }
        .doc-text { font-size: 18px; line-height: 1.5; }
        .doc-list-item { font-size: 16px; line-height: 1.5; }

        /* Diagram Elements (C4 Style) */
        .system-boundary { fill: none; stroke: #bdc3c7; stroke-width: 3; stroke-dasharray: 10 5; }
        .system-box { fill: #f1c40f; stroke: #f39c12; stroke-width: 4; cursor: pointer; transition: all 0.2s; }
        .person-box { fill: #2ecc71; stroke: #27ae60; stroke-width: 4; }
        .db-box { fill: #3498db; stroke: #2980b9; stroke-width: 4; }
        .interactive:hover { opacity: 0.8; transform: scale(1.02); }

        /* Buttons and UI */
        .button { fill: #ecf0f1; stroke: #bdc3c7; stroke-width: 2; cursor: pointer; }
        .button:hover { fill: #dfe6e9; }
        .button-text { font-size: 18px; font-weight: bold; text-anchor: middle; alignment-baseline: central; fill: #2c3e50; pointer-events: none; }

        /* The Documentation Panel */
        #docPanel { fill: #ecf0f1; stroke: #bdc3c7; stroke-width: 2; }
    </style>

    <!--
    ================================================================================
    2. DATA STORE (Hidden XML for Documentation)
    ================================================================================
    This section holds the textual data (Requirements, User Stories, ADRs) for all components.
    It is hidden using the 'display: none;' style.
    -->
    <defs>
        <g id="data-auth-service" style="display:none;">
            <text x="0" y="0" class="section-header">Authentication Service Documentation</text>
            <text x="0" y="40" class="subtitle">Component ID: Auth-Service</text>

            <text x="0" y="80" class="section-header">1. Requirements &amp; User Stories</text>
            <text x="0" y="120" class="doc-list-item">- R1: The system MUST authenticate users via JWT within 100ms.</text>
            <text x="0" y="145" class="doc-list-item">- R2: Password hashes MUST use Argon2.</text>
            <text x="0" y="170" class="doc-list-item">- US1: As a user, I want to log in securely so I can access my data.</text>

            <text x="0" y="210" class="section-header">2. Architectural Decision Record (ADR 001)</text>
            <text x="0" y="250" class="doc-text">Title: Choosing JWT for Session Management.</text>
            <text x="0" y="280" class="doc-text">Status: Accepted.</text>
            <text x="0" y="310" class="doc-text">Decision: We will use stateless JSON Web Tokens (JWT) for session management to simplify horizontal scaling and remove the need for a central session store. This trades complexity in token management for operational simplicity.</text>

            <text x="0" y="350" class="section-header">3. Key Flows</text>
            <text x="0" y="390" class="doc-text">Login Flow: User submits credentials -> Auth Service verifies hash -> Generates JWT -> Returns token to client.</text>
        </g>

        <g id="data-product-database" style="display:none;">
            <text x="0" y="0" class="section-header">Product Database Documentation</text>
            <text x="0" y="40" class="subtitle">Component ID: ProductDB</text>

            <text x="0" y="80" class="section-header">1. Requirements &amp; User Stories</text>
            <text x="0" y="120" class="doc-list-item">- R3: The system MUST achieve 99.99% read uptime for product data.</text>
            <text x="0" y="145" class="doc-list-item">- R4: Product inventory MUST be eventually consistent (max 5s lag).</text>
            <text x="0" y="170" class="doc-list-item">- US2: As a buyer, I want to view product details quickly so I can make a purchase decision.</text>

            <text x="0" y="210" class="section-header">2. Architectural Decision Record (ADR 003)</text>
            <text x="0" y="250" class="doc-text">Title: Utilizing Postgres for Structured Product Data.</text>
            <text x="0" y="280" class="doc-text">Status: Accepted.</text>
            <text x="0" y="310" class="doc-text">Decision: Postgres was chosen for its mature support for JSONB (for flexible attributes) and its strong transaction guarantees, which are necessary for handling inventory updates reliably.</text>
        </g>
    </defs>

    <!--
    ================================================================================
    3. MAIN VIEW (The Architecture Diagram + Document Panel)
    ================================================================================
    -->

    <!-- Main Title and Legend -->
    <text x="1000" y="50" class="title" text-anchor="middle">Software Architecture: Level 1 - System Context</text>
    <text x="1000" y="80" class="subtitle" text-anchor="middle">Click on a component in the diagram to view detailed documentation.</text>

    <!-- Diagram Area (Left) -->
    <g id="diagramArea">
        <rect x="50" y="120" width="900" height="1000" fill="#fcfcfc" stroke="#e0e0e0" stroke-width="2" rx="10" ry="10"/>

        <!-- Person (User) -->
        <rect x="100" y="450" width="100" height="150" class="person-box"/>
        <text x="150" y="550" text-anchor="middle" font-weight="bold" fill="#ffffff" font-size="16">User</text>
        <text x="150" y="575" text-anchor="middle" fill="#ffffff" font-size="14">[Person]</text>

        <!-- System Boundary (Internal System) -->
        <rect x="300" y="200" width="600" height="850" class="system-boundary" rx="15" ry="15"/>
        <text x="320" y="230" font-size="20">Internal E-Commerce System</text>

        <!-- Container 1: Web Application -->
        <rect id="webApp" x="350" y="300" width="200" height="150" class="system-box interactive" data-content-id="data-auth-service"/>
        <text x="450" y="370" text-anchor="middle" font-weight="bold" font-size="18">Web Frontend</text>
        <text x="450" y="395" text-anchor="middle" font-size="14">[Container: SPA]</text>
        <text x="450" y="420" text-anchor="middle" font-size="14">Click for Docs</text>

        <!-- Container 2: Auth Service (Linked to data-auth-service) -->
        <rect id="authService" x="650" y="300" width="200" height="150" class="system-box interactive" data-content-id="data-auth-service"/>
        <text x="750" y="370" text-anchor="middle" font-weight="bold" font-size="18">Auth Service</text>
        <text x="750" y="395" text-anchor="middle" font-size="14">[Container: API]</text>
        <text x="750" y="420" text-anchor="middle" font-size="14">Click for Docs</text>

        <!-- Container 3: Database (Linked to data-product-database) -->
        <rect id="productDB" x="500" y="650" width="200" height="150" class="db-box interactive" data-content-id="data-product-database"/>
        <text x="600" y="720" text-anchor="middle" font-weight="bold" fill="#ffffff" font-size="18">Product DB</text>
        <text x="600" y="745" text-anchor="middle" fill="#ffffff" font-size="14">[Container: Postgres]</text>
        <text x="600" y="770" text-anchor="middle" fill="#ffffff" font-size="14">Click for Docs</text>

        <!-- Relationships (Simple Lines) -->
        <!-- User -> Web Frontend -->
        <line x1="200" y1="525" x2="350" y2="375" stroke="#7f8c8d" stroke-width="2" marker-end="url(#arrowhead)"/>
        <text x="275" y="450" font-size="14" fill="#7f8c8d" text-anchor="middle">Uses</text>

        <!-- Web Frontend -> Auth Service -->
        <line x1="550" y1="375" x2="650" y2="375" stroke="#7f8c8d" stroke-width="2" marker-end="url(#arrowhead)"/>
        <text x="600" y="365" font-size="14" fill="#7f8c8d" text-anchor="middle">Authenticates via API</text>

        <!-- Web Frontend <-> Product DB -->
        <line x1="450" y1="450" x2="550" y2="650" stroke="#7f8c8d" stroke-width="2" marker-end="url(#arrowhead)"/>
        <text x="475" y="550" font-size="14" fill="#7f8c8d">Reads/Writes Product Data</text>

        <!-- Arrowhead definition -->
        <marker id="arrowhead" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="6" markerHeight="6" orient="auto">
            <path d="M 0 0 L 10 5 L 0 10 z" fill="#7f8c8d" />
        </marker>
    </g>

    <!-- Documentation Panel (Right) -->
    <g id="docPanelContainer">
        <rect id="docPanel" x="1000" y="120" width="900" height="1000" rx="10" ry="10"/>

        <!-- Initial Placeholder Text -->
        <g id="initialText">
            <text x="1450" y="500" class="title" text-anchor="middle" fill="#bdc3c7">Click a box on the left</text>
            <text x="1450" y="550" class="subtitle" text-anchor="middle">to load its Requirements, Stories, and ADRs.</text>
        </g>

        <!-- Content Injection Area -->
        <g id="contentInjection" transform="translate(1050, 170)">
            <!-- Content will be injected here by JavaScript -->
        </g>
    </g>

    <!--
    ================================================================================
    4. EMBEDDED JAVASCRIPT LOGIC
    ================================================================================
    This script handles the interaction and dynamic content loading.
    -->
    <script type="text/ecmascript">
    <![CDATA[
        // --- Data Retrieval and DOM Manipulation ---

        function loadContent(dataId) {
            // 1. Get the source content group from the hidden <defs>
            const sourceGroup = document.getElementById(dataId);
            const injectionArea = document.getElementById('contentInjection');
            const initialText = document.getElementById('initialText');
            
            if (!sourceGroup) {
                console.error("Content ID not found: " + dataId);
                return;
            }

            // 2. Clear any existing content and hide the initial instructions
            initialText.style.display = 'none';
            injectionArea.innerHTML = '';

            // 3. Clone the content and append it to the injection area
            // We use cloning to move the content from the hidden <defs> to the visible panel.
            // Note: The structure requires adjusting the Y-position for each text element
            // due to SVG's lack of native flow layout like HTML paragraphs.
            
            let yOffset = 0;
            const lineHeight = 30; // Standard line spacing

            // Process children and adjust their Y positions
            Array.from(sourceGroup.children).forEach(child => {
                const clonedChild = child.cloneNode(true);
                
                // Set the initial Y position based on the running offset
                clonedChild.setAttribute('y', yOffset);

                // Increment the offset for the next element
                // Simple logic: increase by 35 for headers, 25 for lists/body text
                if (clonedChild.classList.contains('section-header')) {
                    yOffset += 45;
                } else if (clonedChild.classList.contains('doc-list-item')) {
                    yOffset += 25;
                } else {
                    yOffset += 30;
                }

                injectionArea.appendChild(clonedChild);
            });
        }

        // --- Event Listener Setup ---

        function setupListeners() {
            // Get all interactive elements that contain a 'data-content-id' attribute
            const interactiveElements = document.querySelectorAll('.interactive');

            interactiveElements.forEach(element => {
                const dataId = element.getAttribute('data-content-id');
                if (dataId) {
                    element.addEventListener('click', function() {
                        loadContent(dataId);
                        
                        // Highlight the currently selected box (simple visual feedback)
                        document.querySelectorAll('.system-box, .db-box').forEach(box => {
                            box.style.opacity = '1';
                            box.style.strokeWidth = '4';
                        });
                        element.style.opacity = '0.9';
                        element.style.strokeWidth = '8'; 
                    });
                }
            });
        }

        // Run setup once the SVG is fully loaded (onload event for the window/document)
        // Since this is embedded SVG, we can usually call it directly, but 'onload' on the root
        // SVG element or the script executing at the end works best.
        document.addEventListener('DOMContentLoaded', setupListeners);
        
        // Fallback for browsers loading it as an image/object (less reliable, but worth adding)
        if (typeof window.onload === 'function') {
             const oldOnload = window.onload;
             window.onload = function() { oldOnload(); setupListeners(); };
        } else {
             window.onload = setupListeners;
        }

    ]]>
    </script>
</svg>