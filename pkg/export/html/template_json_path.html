<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Architecture: {{.ArchName | escapeHTML}}</title>
</head>
<body>
  <div id="sruja-app"></div>
  <p style="padding: 2rem; text-align: center; font-family: system-ui, sans-serif; color: #666;">
    This export mode (external JSON file) is deprecated. Use SVG mode for standalone HTML export.
  </p>

  <script>
    (async function() {
      try {
        // Load JSON from file
        const response = await fetch('./{{.JSONPath | escapeHTML}}');
        const jsonData = await response.json();
        // Wait for viewer to be available - check multiple possible export patterns
        let ViewerClass = null;
        let createViewerFn = null;
        
        // Check for nested export (UMD pattern)
        if (typeof window !== 'undefined' && window.SrujaViewer) {
          if (window.SrujaViewer.SrujaViewer && typeof window.SrujaViewer.SrujaViewer === 'function') {
            ViewerClass = window.SrujaViewer.SrujaViewer;
          } else if (typeof window.SrujaViewer === 'function') {
            ViewerClass = window.SrujaViewer;
          }
          if (window.SrujaViewer.createViewer && typeof window.SrujaViewer.createViewer === 'function') {
            createViewerFn = window.SrujaViewer.createViewer;
          }
        }
        
        // Check for direct global export
        if (!ViewerClass && typeof SrujaViewer !== 'undefined' && typeof SrujaViewer === 'function') {
          ViewerClass = SrujaViewer;
        }
        if (!createViewerFn && typeof createViewer !== 'undefined' && typeof createViewer === 'function') {
          createViewerFn = createViewer;
        }
        
        if (createViewerFn) {
          const viewer = createViewerFn({
            container: '#sruja-app',
            data: jsonData
          });
          await viewer.init();
        } else if (ViewerClass) {
          const viewer = new ViewerClass({
            container: '#sruja-app',
            data: jsonData
          });
          await viewer.init();
        } else {
          document.getElementById('sruja-app').innerHTML = '<div style="padding: 2rem; text-align: center; font-family: system-ui, sans-serif;"><h2>Viewer Not Available</h2><p>The Sruja Viewer JavaScript library is not loaded.</p><p>Please ensure <code>sruja-viewer.js</code> is available.</p></div>';
        }
      } catch (error) {
        console.error('Error loading architecture:', error);
        document.getElementById('sruja-app').innerHTML = '<div style="padding: 2rem; text-align: center; font-family: system-ui, sans-serif; color: #dc2626;"><h2>Error Loading Architecture</h2><p>' + error.message + '</p><pre style="background: #fee; padding: 1rem; margin-top: 1rem; text-align: left; max-width: 600px; margin-left: auto; margin-right: auto; overflow: auto;">' + error.stack + '</pre></div>';
      }
    })();
  </script>
</body>
</html>
